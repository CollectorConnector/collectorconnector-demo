<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CollectorConnector — Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #000;
      --fg: #fff;
      --muted: #a0a0a0;
      --card-bg: #121212;
      --border: #242424;
      --button-bg: #fff;
      --button-fg: #000;
      --radius-card: 18px;
      --shadow-soft: 0 10px 24px rgba(0,0,0,0.45);
      --t-fast: .18s ease-out;
    }

    * { box-sizing: border-box; margin:0; padding:0; }

    body{
      min-height:100vh;
      background: radial-gradient(circle at top, #171717 0, #080808 45%, #000 100%);
      color: var(--fg);
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    h1,h2,h3{
      font-family:"Playfair Display","Times New Roman",serif;
      letter-spacing:.02em;
    }

    /* Layout shell */
    .page-wrap{
      max-width: 1140px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    .app-shell{
      width:100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:28px;
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow-soft);
      overflow:hidden;
      backdrop-filter: blur(14px);
    }

    .app-inner{
      display:flex;
      flex-direction:column;
      width:100%;
    }

    /* Header */
    .app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 20px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: radial-gradient(circle at top left, rgba(255,255,255,0.05), transparent 55%);
    }

    .brand-left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .brand-icon{
      width:32px; height:32px; border-radius:8px; overflow:hidden; flex-shrink:0;
      border:1px solid rgba(255,255,255,0.1);
      background:#0e0e0e;
      display:flex; align-items:center; justify-content:center;
    }
    .brand-icon img{ width:100%; height:100%; object-fit:contain; display:block; }

    .brand-text{ display:flex; flex-direction:column; gap:2px; }
    .brand-name{ font-size:.98rem; font-weight:600; letter-spacing:.08em; text-transform:uppercase; }
    .brand-tagline{ font-size:.78rem; color:var(--muted); }

    .header-right{
      display:flex; align-items:center; gap:12px; color:var(--muted); font-size:.8rem;
      padding:6px 8px; border-radius:999px; border:1px solid rgba(255,255,255,0.08);
      background: #0f0f0f;
    }
    .beta-pill{
      padding:2px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.18);
      background: #0a0a0a; font-size:.72rem; letter-spacing:.12em; text-transform:uppercase;
      color:#d6d6d6;
    }
    .version-tag{ opacity:.9; }

    .avatar{
      width:36px; height:36px; border-radius:50%;
      border:1px solid rgba(255,255,255,0.25);
      overflow:hidden; background:#0d0d0d;
      display:inline-flex; align-items:center; justify-content:center;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* Main card (Option B) */
    .card{
      margin:16px;
      background:#0b0b0b;
      border:1px solid var(--border);
      border-radius:16px;
      display:flex;
      min-height:480px;
      overflow:hidden;
      box-shadow: var(--shadow-soft);
    }

    .card-left,
    .card-right{ padding:32px; }

    .card-left{
      flex:1; border-right:1px solid var(--border);
      display:flex; flex-direction:column; gap:12px; justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    }

    .left-logo img{
      width:55%;
      max-width:260px;
      display:block;
      margin-bottom:10px;
      filter: none;
    }

    .welcome-title{ font-size:2rem; font-weight:600; margin-bottom:6px; }
    .welcome-subtitle{ font-size:.95rem; color:#b8b8b8; line-height:1.5; max-width:460px; }
    .welcome-hero{ margin-top:10px; font-size:1rem; font-weight:500; color:#fff; }
    .welcome-footnote{ margin-top:16px; font-size:.82rem; color:#9a9a9a; max-width:480px; }

    /* Right: login / dashboard container */
    .card-right{
      flex:1;
      display:flex; flex-direction:column; justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
    }

    .login-title{ font-size:1.4rem; margin-bottom:4px; }
    .login-subtitle{ font-size:.85rem; color:#a0a0a0; margin-bottom:16px; }

    .panel{
      background: #0f0f0f;
      border-radius: var(--radius-card);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 8px 18px rgba(0,0,0,0.5);
      overflow: hidden;
      position: relative;
    }

    .panel-login{ display:flex; width:100%; flex-wrap:wrap; }
    .login-left{
      flex:1 1 320px; padding:28px; border-right:1px solid rgba(255,255,255,0.06);
      display:flex; flex-direction:column; gap:10px; justify-content:center;
      background:#101010;
      min-width: 280px;
    }
    .login-right{
      flex:1 1 320px; padding:28px; display:flex; flex-direction:column; justify-content:center; gap:14px;
      background:#0e0e0e;
      min-width: 280px;
    }

    .field-label{
      font-size:.78rem; text-transform:uppercase; letter-spacing:.12em; color:#bdbdbd;
    }
    .field-input{
      margin-top:4px; width:100%; padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.16);
      background: #0b0b0b; color:#fff; font-size:.9rem; outline:none;
      transition: border-color var(--t-fast), box-shadow var(--t-fast), background var(--t-fast);
    }
    .field-input::placeholder{ color:rgba(255,255,255,0.35); }
    .field-input:focus{ border-color:rgba(255,255,255,0.5); box-shadow:0 0 0 1px rgba(255,255,255,0.25); background:#0c0c0c; }

    .row{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .row-left{ display:flex; align-items:center; gap:6px; }
    .link{ color:#fff; text-decoration:none; font-size:.82rem; }
    .link:hover{ text-decoration:underline; }

    .btn-primary, .btn-secondary{
      margin-top:8px; padding:10px 14px; width:100%; border-radius:999px; border:none;
      font-size:.92rem; font-weight:600; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; gap:6px;
      transition: background var(--t-fast), color var(--t-fast), border-color var(--t-fast), box-shadow var(--t-fast);
      letter-spacing:.06em; text-transform:uppercase;
      box-shadow:none;
    }
    .btn-primary{ background:#fff; color:#000; }
    .btn-primary:hover{ background:#f1f1f1; }

    .btn-secondary{
      background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.35);
    }
    .btn-secondary:hover{ background:rgba(255,255,255,0.06); }

    .or-divider{ display:flex; align-items:center; gap:10px; margin:8px 0; color:#a0a0a0; font-size:.8rem; }
    .or-divider span{ flex:1; height:1px; background:var(--border); }

    /* Dashboard */
    .dashboard{ display:none; flex-direction:column; gap:16px; margin-top:16px; }
    .dash-header-row{ display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .dash-title-block{ display:flex; flex-direction:column; gap:4px; }
    .dash-title{ font-size:1.4rem; }
    .dash-subtitle{ font-size:.88rem; color:#b0b0b0; max-width:360px; }

    .dash-pills{ display:flex; align-items:center; gap:8px; font-size:.75rem; flex-wrap:wrap; }
    .pill-soft{
      padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.18);
      background: #0b0b0b; color:#cfcfcf; text-transform:uppercase; letter-spacing:.12em;
    }
    .pill-soft strong{ color:#fff; font-weight:600; }
    .pill-outline{
      padding:4px 10px; border-radius:999px; border:1px dashed rgba(255,255,255,0.3);
      color:#a9a9a9; text-transform:uppercase; letter-spacing:.12em;
    }

    .grid-3{
      display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:10px;
    }

    .dash-card{
      border-radius:14px; border:1px solid rgba(255,255,255,0.12);
      background:#0f0f0f;
      padding:12px; position:relative; overflow:hidden;
      transition: background var(--t-fast), border-color var(--t-fast);
    }
    .dash-card:hover{ border-color:rgba(255,255,255,0.18); background:#121212; }

    .card-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px; }
    .card-title{ font-size:.92rem; font-weight:600; letter-spacing:.12em; text-transform:uppercase; }
    .card-tag{ font-size:.72rem; color:#b0b0b0; text-transform:uppercase; letter-spacing:.12em; }
    .card-body{ font-size:.85rem; color:#bdbdbd; display:flex; flex-direction:column; gap:4px; }
    .metric-row{ display:flex; align-items:baseline; justify-content:space-between; gap:6px; }
    .metric-label{ font-size:.8rem; color:#b0b0b0; }
    .metric-value{ font-size:1rem; font-weight:600; color:#fff; }
    .metric-pill{ padding:2px 8px; border-radius:999px; border:1px solid rgba(255,255,255,0.18); font-size:.76rem; color:#cfcfcf; }
    .metric-pill strong{ color:#fff; }

    /* Profile + Gallery panels */
    .panel-section{
      margin: 12px 16px 20px;
      display: grid;
      grid-template-columns: 1fr 1.6fr;
      gap: 16px;
    }
    .profile-panel, .gallery-panel{
      background:#0f0f0f;
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:16px;
    }
    .section-title{
      font-size:1.1rem; font-weight:600; margin-bottom:8px; letter-spacing:.08em;
    }
    .section-sub{ font-size:.9rem; color:#b0b0b0; margin-bottom:12px; }

    .profile-avatar-lg{
      width:120px; height:120px; border-radius:50%; overflow:hidden;
      border:1px solid rgba(255,255,255,0.25);
      background:#111; display:flex; align-items:center; justify-content:center;
      margin-bottom:12px;
    }
    .profile-avatar-lg img{ width:100%; height:100%; object-fit:cover; display:block; }

    .inline-actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn-small{
      padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.25);
      background:transparent; color:#fff; font-size:.82rem; cursor:pointer;
    }
    .btn-small:hover{ background:rgba(255,255,255,0.06); }

    .hint{ font-size:.8rem; color:#9a9a9a; margin-top:8px; }

    .uploader{
      padding:12px; border:1px dashed rgba(255,255,255,0.25); border-radius:12px;
      background:#0c0c0c;
    }
    .uploader label{ font-size:.88rem; color:#dcdcdc; display:block; margin-bottom:8px; }
    .uploader input{ display:block; }

    .gallery-grid{
      margin-top:12px;
      display:grid; grid-template-columns:repeat(3, minmax(0,1fr));
      gap:10px;
    }
    .gallery-item{
      position:relative; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.12);
      background:#0b0b0b;
      aspect-ratio: 1 / 1;
    }
    .gallery-item img{ width:100%; height:100%; object-fit:cover; display:block; }
    .delete-btn{
      position:absolute; top:6px; right:6px;
      background: rgba(0,0,0,0.55);
      color:#fff; border:1px solid rgba(255,255,255,0.35);
      border-radius:999px; font-size:.78rem; padding:4px 8px; cursor:pointer;
    }
    .delete-btn:hover{ background: rgba(255,255,255,0.12); }

    /* Footer */
    .app-footer{
      padding:12px 16px; font-size:.75rem; color:#a0a0a0; display:flex; align-items:center; justify-content:space-between;
      border-top:1px solid rgba(255,255,255,0.06);
      background: #0f0f0f;
    }
    .footer-left{ display:flex; align-items:center; gap:10px; text-transform:uppercase; letter-spacing:.16em; }
    .footer-dot{ width:6px; height:6px; border-radius:999px; background:#3ddc84; }

    /* ---- Fill left space on main page (collapse left column when logged in) ---- */
    .logged-in .card-left { display: none !important; }
    .logged-in .card { display: block; }
    .logged-in .card-right { width: 100%; padding: 32px; }
    .logged-in .panel-section { margin-left:16px; margin-right:16px; }
    @media (min-width: 1200px){
      .logged-in .grid-3{ grid-template-columns:repeat(4, minmax(0,1fr)); }
    }

    /* Accessibility focus */
    .btn-primary:focus-visible, .btn-secondary:focus-visible, .btn-small:focus-visible, .link:focus-visible, input:focus-visible{
      outline:2px solid #fff; outline-offset:2px;
    }

    /* Responsive */
    @media (max-width: 900px){
      .card{ flex-direction:column; }
      .card-left{ border-right:none; border-bottom:1px solid var(--border); }
      .grid-3{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
      .panel-section{ grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      .grid-3{ grid-template-columns:1fr; }
      .gallery-grid{ grid-template-columns:repeat(2, minmax(0,1fr)); }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="app-shell">
      <div class="app-inner">

        <!-- HEADER -->
        <header class="app-header" role="banner">
          <div class="brand-left">
            <div class="brand-icon">
              <img src="./CCLogoSML.png" alt="CollectorConnector icon">
            </div>
            <div class="brand-text">
              <div class="brand-name">CollectorConnector</div>
              <div class="brand-tagline">A home for collectors</div>
            </div>
          </div>

          <div class="header-right">
            <div class="beta-pill">Demo</div>
            <div class="version-tag">v0.4</div>
            <div class="avatar" aria-label="Profile photo">
              <img id="header-avatar" src="./CCLogoSML.png" alt="Profile">
            </div>
          </div>
        </header>

        <!-- MAIN -->
        <main>
          <div class="card">
            <!-- LEFT -->
            <section class="card-left" aria-label="Welcome">
              <div class="left-logo">
                <img src="./CC-mainlogo.jpg" alt="CollectorConnector">
              </div>
              <h1 class="welcome-title">Welcome back</h1>
              <p class="welcome-subtitle">
                Sign in to continue building your world of collections. Your collections
                deserve a home that reflects the stories behind each piece.
              </p>
              <p class="welcome-hero">Your collection deserves a home.</p>
              <p class="welcome-footnote">
                CollectorConnector is where identity, culture, and belonging come together through the pieces you love.
              </p>
            </section>

            <!-- RIGHT -->
            <section class="card-right" aria-label="Authentication and dashboard">
              <!-- LOGIN VIEW -->
              <div id="login-view" class="panel panel-login" aria-hidden="false" aria-live="polite">
                <div class="login-left">
                  <div class="login-title">Log in</div>
                  <div class="login-subtitle">
                    This login is visual only for your demo. Click “Log in” or press Enter to switch to your dashboard.
                  </div>
                  <div class="or-divider"><span></span> OR <span></span></div>
                  <button class="btn-secondary" type="button" id="skip-button">Skip to Demo</button>
                </div>

                <div class="login-right">
                  <form id="login-form" autocomplete="off" novalidate>
                    <label class="field-label" for="email">Email</label>
                    <input id="email" class="field-input" type="email" placeholder="you@example.com" />

                    <label class="field-label" for="password">Password</label>
                    <input id="password" class="field-input" type="password" placeholder="••••••••" />

                    <div class="row">
                      <div class="row-left">
                        <input id="remember" type="checkbox" />
                        <label for="remember" style="text-transform:none;letter-spacing:0;">Remember me</label>
                      </div>
                      <a href="#" class="link">Forgot password?</a>
                    </div>

                    <button id="login-button" class="btn-primary" type="submit">
                      <span>Log in</span><span>→</span>
                    </button>
                  </form>
                </div>
              </div>

              <!-- DASHBOARD VIEW -->
              <div id="dashboard-view" class="dashboard" aria-hidden="true" aria-live="polite">
                <div class="dash-header-row">
                  <div class="dash-title-block">
                    <h2 class="dash-title">Your Dashboard</h2>
                    <p class="dash-subtitle">A calm overview of your world of pieces.</p>
                    <div class="dash-pills">
                      <div class="pill-soft"><strong>3</strong> Collections</div>
                      <div class="pill-soft"><strong>18</strong> Pieces</div>
                      <div class="pill-outline">Private</div>
                    </div>
                  </div>
                  <button id="logout-button" class="btn-secondary" type="button">Log out</button>
                </div>

                <div class="grid-3" style="margin-top:10px;">
                  <!-- Collections -->
                  <div class="dash-card">
                    <div class="card-header">
                      <div class="card-title">Collections</div>
                      <div class="card-tag">Overview</div>
                    </div>
                    <div class="card-body">
                      <div class="metric-row">
                        <div class="metric-label">Total</div>
                        <div class="metric-value">3</div>
                      </div>
                      <div class="metric-row">
                        <div class="metric-label">Most Active</div>
                        <div class="metric-pill"><strong>Watches</strong></div>
                      </div>
                    </div>
                  </div>

                  <!-- Pieces -->
                  <div class="dash-card">
                    <div class="card-header">
                      <div class="card-title">Pieces</div>
                      <div class="card-tag">Inventory</div>
                    </div>
                    <div class="card-body">
                      <div class="metric-row">
                        <div class="metric-label">Total</div>
                        <div class="metric-value">18</div>
                      </div>
                      <div class="metric-row">
                        <div class="metric-label">Latest Added</div>
                        <div class="metric-pill"><strong>Omega Seamaster</strong></div>
                      </div>
                    </div>
                  </div>

                  <!-- Favourite Piece -->
                  <div class="dash-card">
                    <div class="card-header">
                      <div class="card-title">Favourite Piece</div>
                      <div class="card-tag">Personal</div>
                    </div>
                    <div class="card-body">
                      <div class="metric-row" style="justify-content:flex-start; gap:10px;">
                        <div class="metric-pill"><strong>Rolex Submariner (1998)</strong></div>
                      </div>
                      <div class="metric-row" style="justify-content:flex-start;">
                        <div class="metric-label">Your most meaningful piece</div>
                      </div>
                      <div class="metric-row" style="justify-content:flex-start;">
                        <div class="metric-label">A reminder of where your collecting journey began.</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Profile + Gallery Section -->
                <div class="panel-section" aria-label="Profile and Collection Photos">
                  <!-- Profile panel -->
                  <section class="profile-panel" aria-labelledby="profileTitle">
                    <h3 id="profileTitle" class="section-title">Profile Photo</h3>
                    <p class="section-sub">Upload a picture to appear in your header and profile.</p>
                    <div class="profile-avatar-lg">
                      <img id="profile-avatar-lg" src="./CCLogoSML.png" alt="Profile large">
                    </div>
                    <div class="inline-actions">
                      <label class="btn-small" for="profile-file">Upload profile photo</label>
                      <input id="profile-file" type="file" accept="image/*" style="display:none" />
                      <button id="clear-profile" class="btn-small" type="button">Remove profile photo</button>
                    </div>
                    <p class="hint">Tip: square images look best. We’ll auto‑fit and lightly compress to keep it fast.</p>
                  </section>

                  <!-- Gallery panel -->
                  <section class="gallery-panel" aria-labelledby="galleryTitle">
                    <h3 id="galleryTitle" class="section-title">Your Collection Photos</h3>
                    <p class="section-sub">Add photos of your pieces. This demo keeps them locally in your browser.</p>
                    <div class="uploader">
                      <label for="gallery-files">Upload images (you can select multiple):</label>
                      <input id="gallery-files" type="file" accept="image/*" multiple />
                      <p class="hint">Images are compressed to max 1280px for performance. Stored locally (no server).</p>
                      <div class="inline-actions" style="margin-top:8px;">
                        <button id="clear-gallery" class="btn-small" type="button">Clear all photos</button>
                      </div>
                    </div>

                    <div id="gallery-grid" class="gallery-grid" aria-live="polite"></div>
                  </section>
                </div>
              </div> <!-- /dashboard-view -->
            </section>
          </div>
        </main>

        <!-- FOOTER -->
        <footer class="app-footer" role="contentinfo">
          <div class="footer-left">
            <div class="footer-dot"></div>
            <div>CollectorConnector Demo</div>
          </div>
          <span>Where collectors meet, remember, and get seen.</span>
          <div class="footer-right">Demo build – visual login only</div>
        </footer>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    (function(){
      // --- Elements
      const loginForm = document.getElementById("login-form");
      const loginButton = document.getElementById("login-button");
      const skipButton = document.getElementById("skip-button");
      const logoutButton = document.getElementById("logout-button");
      const loginView = document.getElementById("login-view");
      const dashboardView = document.getElementById("dashboard-view");

      const headerAvatarImg = document.getElementById("header-avatar");
      const profileAvatarLgImg = document.getElementById("profile-avatar-lg");
      const profileFile = document.getElementById("profile-file");
      const clearProfileBtn = document.getElementById("clear-profile");

      const galleryInput = document.getElementById("gallery-files");
      const clearGalleryBtn = document.getElementById("clear-gallery");
      const galleryGrid = document.getElementById("gallery-grid");

      // --- Storage keys
      const VISUAL_LOGIN_KEY = "cc-demo-visual-login";
      const PROFILE_IMG_KEY  = "cc-demo-profile-image";
      const GALLERY_KEY      = "cc-demo-gallery-images";

      // --- Helpers: image load & resize
      function readFileAsDataURL(file){
        return new Promise((resolve, reject)=>{
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      function loadImage(src){
        return new Promise((resolve, reject)=>{
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = src;
        });
      }

      async function resizeImageDataURL(dataUrl, maxSize=1280, quality=0.85){
        const img = await loadImage(dataUrl);
        let {width, height} = img;

        // Determine new size keeping aspect ratio
        if (width > height && width > maxSize){
          const ratio = maxSize / width;
          width = maxSize; height = Math.round(height * ratio);
        } else if (height >= width && height > maxSize){
          const ratio = maxSize / height;
          height = maxSize; width = Math.round(width * ratio);
        }

        const canvas = document.createElement("canvas");
        canvas.width = width; canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height);

        return canvas.toDataURL("image/jpeg", quality);
      }

      async function processProfileImage(file){
        const dataUrl = await readFileAsDataURL(file);
        // Smaller cap for avatars
        return resizeImageDataURL(dataUrl, 512, 0.9);
      }

      // --- View toggles
      function setHidden(el, hidden){
        if(!el) return;
        el.setAttribute("aria-hidden", hidden ? "true" : "false");
        try { el.inert = !!hidden; } catch(e){}
      }

      function showDashboard(){
        if(!loginView || !dashboardView) return;
        setHidden(loginView, true);
        setHidden(dashboardView, false);
        loginView.style.display = "none";
        dashboardView.style.display = "flex";
        document.body.classList.add("logged-in");  // collapse left column
        try { sessionStorage.setItem(VISUAL_LOGIN_KEY, "1"); } catch(e){}
      }

      function showLogin(){
        if(!loginView || !dashboardView) return;
        dashboardView.style.display = "none";
        loginView.style.display = "block";
        setHidden(loginView, false);
        setHidden(dashboardView, true);
        document.body.classList.remove("logged-in"); // restore two-column
        try { sessionStorage.removeItem(VISUAL_LOGIN_KEY); } catch(e){}
      }

      // --- Profile image: save/render
      function renderProfile(src){
        const fallback = "./CCLogoSML.png";
        const useSrc = src || fallback;
        if (headerAvatarImg) headerAvatarImg.src = useSrc;
        if (profileAvatarLgImg) profileAvatarLgImg.src = useSrc;
      }

      function saveProfile(src){
        try { localStorage.setItem(PROFILE_IMG_KEY, src || ""); } catch(e){}
        renderProfile(src);
      }

      function loadProfile(){
        let stored = "";
        try { stored = localStorage.getItem(PROFILE_IMG_KEY) || ""; } catch(e){}
        renderProfile(stored || "");
      }

      // --- Gallery: load/save/render
      function getGallery(){
        try {
          const raw = localStorage.getItem(GALLERY_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch(e){
          return [];
        }
      }

      function saveGallery(arr){
        try { localStorage.setItem(GALLERY_KEY, JSON.stringify(arr)); } catch(e){}
      }

      function renderGallery(){
        const items = getGallery();
        galleryGrid.innerHTML = "";
        if (!items.length) return;

        items.forEach((src, idx)=>{
          const wrap = document.createElement("div");
          wrap.className = "gallery-item";

          const img = document.createElement("img");
          img.src = src; img.alt = `Collection photo ${idx+1}`;

          const del = document.createElement("button");
          del.className = "delete-btn";
          del.type = "button";
          del.setAttribute("data-index", String(idx));
          del.setAttribute("aria-label", `Remove photo ${idx+1}`);
          del.textContent = "Delete";

          wrap.appendChild(img);
          wrap.appendChild(del);
          galleryGrid.appendChild(wrap);
        });
      }

      // --- Event wiring
      if (loginForm) {
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          showDashboard();
        });
      }
      if (loginButton) {
        loginButton.addEventListener("click", () => showDashboard());
      }
      if (skipButton) {
        skipButton.addEventListener("click", () => showDashboard());
      }
      if (logoutButton) {
        logoutButton.addEventListener("click", showLogin);
      }

      if (profileFile) {
        profileFile.addEventListener("change", async (e)=>{
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          try {
            const processed = await processProfileImage(file);
            saveProfile(processed);
          } catch(err){
            alert("Sorry, that image could not be processed.");
          } finally {
            profileFile.value = "";
          }
        });
      }

      if (clearProfileBtn) {
        clearProfileBtn.addEventListener("click", ()=>{
          saveProfile("");
        });
      }

      if (galleryInput) {
        galleryInput.addEventListener("change", async (e)=>{
          const files = Array.from(e.target.files || []);
          if (!files.length) return;

          const existing = getGallery();
          for (const f of files){
            try {
              const raw = await readFileAsDataURL(f);
              const resized = await resizeImageDataURL(raw, 1280, 0.85);
              existing.push(resized);
            } catch(err){
              // Skip problematic file
            }
          }
          saveGallery(existing);
          renderGallery();
          galleryInput.value = "";
        });
      }

      if (clearGalleryBtn) {
        clearGalleryBtn.addEventListener("click", ()=>{
          if (confirm("Remove all collection photos from this browser?")) {
            saveGallery([]);
            renderGallery();
          }
        });
      }

      if (galleryGrid) {
        galleryGrid.addEventListener("click", (e)=>{
          const btn = e.target.closest(".delete-btn");
          if (!btn) return;
          const idx = parseInt(btn.getAttribute("data-index"), 10);
          if (Number.isNaN(idx)) return;
          const items = getGallery();
          items.splice(idx, 1);
          saveGallery(items);
          renderGallery();
        });
      }

      // --- Restore state on load
      let wasLogged = false;
      try { wasLogged = sessionStorage.getItem(VISUAL_LOGIN_KEY) === "1"; } catch(e){}
      if(wasLogged) { showDashboard(); } else { showLogin(); }
      loadProfile();
      renderGallery();
    })();
  </script>
</body>
</html>
